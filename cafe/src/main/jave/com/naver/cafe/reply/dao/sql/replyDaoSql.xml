<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ReplyDao">

	<resultMap type="ReplyVO" id="replyMap">
		<id column="RPLY_ID" property="replyId"/>
		<result column="LEVEL" property="level"/>
		<result column="R_AR_ID" property="articleId"/>
		<result column="R_CONT" property="content"/>
		<result column="R_CRT_DT" property="createdDate"/>
		<result column="R_MBR_ID" property="memberId"/>
		<result column="RCMND_CNT" property="recommendCount"/>
		<result column="PRNT_RPLY_ID" property="parentReplyId"/>
		
		<association property="clubVO" javaType="ClubVO">
				<id column="AR_ID" property="articleId"/>
		<result column="SBJ" property="subject"/>
		<result column="CONT" property="content"/>
		<result column="C_MBR_ID" property="memberId"/>
		<result column="C_CRT_DT" property="createdDate"/>
		<result column="C_MDFY_DT" property="modifiedDate"/>
		<result column="C_RD_CNT" property="readCount"/>
		<result column="C_MN_ID" property="menuId"/>
		</association>
		
		<association property="memberVO" javaType="MemberVO">
		<id column="MBR_ID" property="memeberId"/>
		<result column="NCK_NM" property="nickName"/>
		<result column="AUTH" property="auth"/>
		</association>
		
		<!-- column이 파라미터 역할! selct에 파라미터를 넣어서 select="selectParentReply의 결과를 property에 넣어 주겠따? -->
		<association property="parentReplyVO" javaType="ReplyVO" column="PRNT_RPLY_ID" select="selectParentReply" ></association>
		</resultMap>
		
		
	<select id="selectAllReplies" resultMap="replyMap" parameterType="string">
	SELECT	LEVEL
			, R.RPLY_ID
			, R.AR_ID R_AR_ID
			, R.CONT R_CONT
			, R.CRT_DT R_CRT_DT
			, R.MBR_ID R_MBR_ID
			, R.RCMND_CNT 
			, R.PRNT_RPLY_ID
			, C.AR_ID
			, C.SBJ
			, C.CONT
			, C.MBR_ID C_MBR_ID
			, C.CRT_DT C_CRT_DT
			, C.MDFY_DT C_MDFY_DT
			, C.RD_CNT C_RD_CNT
			, C.MN_ID C_MN_ID
			, M.MBR_ID
			, M.NCK_NM
			, M.AUTH
	FROM		CLB C
			, MBR M
			, RPLY R	
	WHERE	C.MBR_ID = M.MBR_ID
	AND		C.MBR_ID = R.MBR_ID
	AND		R.AR_ID = C.AR_ID
	AND		C.AR_ID = #{articleId}
	START	WITH R.PRNT_RPLY_ID IS NULL
	CONNECT BY PRIOR R.RPLY_ID = R.PRNT_RPLY_ID
	</select>
	
	<select id="selectParentReply" resultMap="replyMap" parameterType="string">
	SELECT	LEVEL
			, R.RPLY_ID
			, R.AR_ID R_AR_ID
			, R.CONT R_CONT
			, R.CRT_DT R_CRT_DT
			, R.MBR_ID R_MBR_ID
			, R.RCMND_CNT 
			, R.PRNT_RPLY_ID
			, C.AR_ID
			, C.SBJ
			, C.CONT
			, C.MBR_ID C_MBR_ID
			, C.CRT_DT C_CRT_DT
			, C.MDFY_DT C_MDFY_DT
			, C.RD_CNT C_RD_CNT
			, C.MN_ID C_MN_ID
			, M.MBR_ID
			, M.NCK_NM
			, M.AUTH
	FROM	CLB C
			, MBR M
			, RPLY R	
	WHERE	C.MBR_ID = M.MBR_ID
	AND		C.MBR_ID = R.MBR_ID
	AND		R.AR_ID = C.AR_ID
	AND		R.RPLY_ID = #{replyId}
	</select>
	
</mapper>
	
	
